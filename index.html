<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<title>出入可視化</title>
<link rel="stylesheet" type="text/css" href="style.css">
</head>
<body  background = "test.png">
  <form name = "form">
    <div id = "form_title">
      Setting
    </div>
    <!-- <span>Setting</span> -->
    <div id = "Y">
      Y :
    </div>
    <div class="custom">
      <select id="options">
        <option value="option_2014">2014</option>
        <option value="option_2013">2013</option>
        <option value="option_2012">2012</option>
      </select>
    </div>
    <div id="radio">
      <input name="RadioGroup" id="Radio1" value="1" type="radio">
      <label for="Radio1">訪日数</label>
      <input name="RadioGroup" id="Radio2" value="2" type="radio" selected="selected">
      <label for="Radio2">訪日・出国数</label>
      <input name="RadioGroup" id="Radio3" value="3" type="radio">
      <label for="Radio3">出国数</label>
    </div>
    </span>
	</form>

  <div id="container"></div>
  <div id="map"></div>

   <script type="text/javascript" src="immigration.js"> </script>
   <script src="jquery-2.1.4.min.js"></script>
   <script src="jquery.japan-map.min.js"></script>
   <script type="text/javascript" >
   //前準備
   const WIDTH_MAX = 1;
   const WIDTH_MIDDLE = 0.7;
   const WIDTH_MIN = 0.5;

   var cvs = document.createElement("canvas");
   cvs.width = 800;
   cvs.height = 800;
   document.getElementById("container").appendChild(cvs);
   var ctx = cvs.getContext("2d");

   ctx.font = "bold 20pt sans-serif";
   ctx.textAlign = "center";
   ctx.translate(400, 400);
   ctx.save();

      function getData(month_num,dataType){

        for(var i = 0; i < dataImmigration.length;i++){
          if(dataImmigration[i][0] == 2014 &&
          dataImmigration[i][1] == month_num){
            if(dataType == "outjapanese"){
              return(dataImmigration[i][2]);
            }
            if(dataType == "inforeigner"){
              return(dataImmigration[i][3]);
            }
          }
        }

      }

      function getMaxData(dataType){
        var max = 0;
          for(j = 1; j <= 12; j++){
              var data =  getData(j,dataType);
              if(max < data){
                max = data;
              }
          }
          return(max);

      }

      var outjapaneseMaxData = getMaxData("outjapanese");
      var inforeignerMaxData = getMaxData("inforeigner");

      //訪日データの可視化
    function inForeigner(month_num){
      var data = getData(month_num,"inforeigner");
      var constriction;

      //12以上の変化
      if(data >= inforeignerMaxData*0.9){
        ctx.fillStyle = "rgba(0,200,0,1.0)";
        constriction = WIDTH_MAX;
      }else if(data < inforeignerMaxData*0.9 && data > inforeignerMaxData*0.7){
        ctx.fillStyle = "rgba(0,160,0,0.7)";
        constriction = WIDTH_MIDDLE;
      }else{
        ctx.fillStyle = "rgba(00,70,0,0.5)";
        constriction = WIDTH_MIN;
      }

       ctx.beginPath();
      //ctx.moveTo(0, 0);
       //左　制御（うえ）　右
       ctx.bezierCurveTo(30*constriction, 5, 0, 240, -30*constriction, 5);
       //(幅、くびれ位置（下向き）、くびれ度合い、くびれ位置（上向き）、座標)
       /*
       ctx.bezierCurveTo(-1*constriction,20,0,60,0,150);
       ctx.bezierCurveTo(0,60,constriction,20,0,5);
       */
       /* 三角形を描く */
      ctx.moveTo(0, 100);
      ctx.lineTo(30*constriction, 100);
      ctx.lineTo(0, 150);
      ctx.lineTo(-30*constriction, 100);
      ctx.closePath();

       ctx.fill();
     }
     //出国データの可視化
     function outJapanese(month_num){
       var data = getData(month_num,"outjapanese");
       //12以上の変化
       if(data >= outjapaneseMaxData * 0.9){
         ctx.fillStyle = "rgba(200,0,0,1.0)"
         constriction = WIDTH_MAX;
       }else if(data < outjapaneseMaxData*0.9 && data > outjapaneseMaxData*0.7){
         ctx.fillStyle = "rgba(160,0,0,0.7)"
         constriction = WIDTH_MIDDLE;
       }else{
         ctx.fillStyle = "rgba(70,0,0,0.5)"
         constriction = WIDTH_MIN;
       }

       ctx.beginPath();
       //左　制御（うえ）　右
       ctx.bezierCurveTo(30*constriction, -30, 0, -265, -30*constriction, -30);
  //     ctx.moveTo(0, -30);
       //高さが+25(-25)
       /*
       ctx.bezierCurveTo(-1*constriction,-45,0,-85,0,-150);
       ctx.bezierCurveTo(0,-85,constriction,-45,0,-30);
        */
        /* 三角形を描く */
        ctx.moveTo(0, -125);
        ctx.lineTo(30*constriction, -125);
        ctx.lineTo(0, -175);
        ctx.lineTo(-30*constriction, -125);
        ctx.closePath();

        ctx.fill();
      }

      function drawVis(vis){
      //1~12円作成
      for (var i = 1; i <= 12; i++) {
         var text = i;
         ctx.rotate(Math.PI / 6);
         ctx.save();
         ctx.translate(0, -220);
         ctx.fillText(text, 0, 0);
         ctx.font = "bold 10pt sans-serif";
         ctx.fillText("月", 30, 0);

         if(vis == "1"){
           inForeigner(i);
         }
          else if(vis == "2"){

           inForeigner(i);
           outJapanese(i);

         }
         if(vis == "3"){
            outJapanese(i);
         }

         ctx.restore();
       }
      }


      //初期画面

      $("input[name='RadioGroup']").val(["2"]);
      drawVis("2");
      $(function(){
            $("#map").japanMap({
              color:"#84b0f6",
              width: 200,
              drawsBoxLine : false,
                onSelect : function(data){
                    alert(data.name);
                }
            });
      });


      //メイン
      var radio = document.getElementsByName("RadioGroup");
      for (var i = 0; i < radio.length; i++) {
       radio[i].addEventListener("change", function() {
         ctx.clearRect(-400, -400, cvs.width*2, cvs.height*2);
         drawVis(this.value);
        });
      }

      </script>
</body>
</html>
