<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<title>出入可視化</title>
<link rel="stylesheet" type="text/css" href="style.css">
</head>
<body  background = "test.png">
  <div id="form">
    <div id = "form_title">
      Setting
    </div>
    <!-- <span>Setting</span> -->
    <div id = "Y">
  Y :
</div>
    <div class="custom">
  <select id="options">
    <option value="option-1">2015</option>
    <option value="option-2">2014</option>
    <option value="option-3">2013</option>
  </select>
</div>

<div class="sample">
  <input name="s3" id="select1" value="1" checked="" type="radio">
  <label for="select1">訪日</label>
  <input name="s3" id="select2" value="2" type="radio">
  <label for="select2">訪日・出国</label>
  <input name="s3" id="select3" value="3" type="radio">
  <label for="select3">出国</label>
</div>

    </span>
	 </div>

  <div id="container"></div>
  <div id="map"></div>
   <script type="text/javascript" src="immigration.js"> </script>
   <script src="jquery-2.1.4.min.js"></script>
    <script src="jquery.japan-map.min.js"></script>
   <script type="text/javascript" >
      const WIDTH_MAX = 1;
      const WIDTH_MIDDLE = 0.7;
      const WIDTH_MIN = 0.5;
      $(function(){
            $("#map").japanMap({
              color:"#84b0f6",
              width: 200,
              drawsBoxLine : false,

                onSelect : function(data){
                    alert(data.name);
                }
            });
      });
       //canvas作成
/*
      var cvs2 = document.createElement("canvas");
      cvs2.width = 800;
      cvs2.height = 800;
      document.getElementById("container").appendChild(cvs2);
      var ctx2 = cvs2.getContext("2d");
      var img = new Image();
      img.src = "test.jpg";
      ctx2.drawImage(img, 0, 0,300,300);
*/
      var cvs = document.createElement("canvas");
      cvs.width = 800;
      cvs.height = 800;
      document.getElementById("container").appendChild(cvs);
      var ctx = cvs.getContext("2d");

      function getData(month_num,dataType){

        for(var i = 0; i < dataImmigration.length;i++){
          if(dataImmigration[i][0] == 2014 &&
          dataImmigration[i][1] == month_num){
            if(dataType == "outjapanese"){
              return(dataImmigration[i][2]);
            }
            if(dataType == "inforeigner"){
              return(dataImmigration[i][3]);
            }
          }
        }

      }

      function getMaxData(dataType){
        var max = 0;
          for(j = 1; j <= 12; j++){
              var data =  getData(j,dataType);
              if(max < data){
                max = data;
              }
          }
          return(max);

      }


      var outjapaneseMaxData = getMaxData("outjapanese");
      var inforeignerMaxData = getMaxData("inforeigner");

      //訪日データの可視化
    function inForeigner(month_num){
      var data = getData(month_num,"inforeigner");
      var effectData = data /inforeignerMaxData;
      var constriction;
      //12以上の変化
      if(data >= 1200000){
        ctx.fillStyle = "rgba(200,0,0,1.0)"
        constriction = WIDTH_MAX;
      }else if(data < 1200000 && data > 1100000){
        ctx.fillStyle = "rgba(160,0,0,1.0)"
        constriction = WIDTH_MIDDLE;
      }else{
        ctx.fillStyle = "rgba(70,0,0,1.0)"
        constriction = WIDTH_MIN;
      }
      ctx.fillText(data,0,0);

       ctx.beginPath();
      //ctx.moveTo(0, 0);
       //左　制御（うえ）　右
       ctx.bezierCurveTo(30*constriction, 5, 0, 240, -30*constriction, 5);
       //(幅、くびれ位置（下向き）、くびれ度合い、くびれ位置（上向き）、座標)
       /*
       ctx.bezierCurveTo(-1*constriction,20,0,60,0,150);
       ctx.bezierCurveTo(0,60,constriction,20,0,5);
       */
       /* 三角形を描く */
      ctx.moveTo(0, 100);
      ctx.lineTo(30*constriction, 100);
      ctx.lineTo(0, 150);
      ctx.lineTo(-30*constriction, 100);
      ctx.closePath();

       //ctx.closePath();
       ctx.fill();
     }
     //出国データの可視化
     function outJapanese(month_num){
       var data = getData(month_num,"outjapanese");
       //12以上の変化
       if(data >= 1500000){
         ctx.fillStyle = "rgba(0,200,0,1.0)"
         constriction = WIDTH_MAX;
       }else if(data < 1500000 && data > 1300000){
         ctx.fillStyle = "rgba(0,200,0,0.7)"
         constriction = WIDTH_MIDDLE;
       }else{
         ctx.fillStyle = "rgba(0,200,0,0.3)"
         constriction = WIDTH_MIN;
       }
       ctx.fillText(data,0,-20);

       ctx.beginPath();
       //左　制御（うえ）　右
       ctx.bezierCurveTo(30*constriction, -30, 0, -265, -30*constriction, -30);
  //     ctx.moveTo(0, -30);
       //高さが+25(-25)
       /*
       ctx.bezierCurveTo(-1*constriction,-45,0,-85,0,-150);
       ctx.bezierCurveTo(0,-85,constriction,-45,0,-30);
        */
        /* 三角形を描く */
        ctx.moveTo(0, -125);
        ctx.lineTo(30*constriction, -125);
        ctx.lineTo(0, -175);
        ctx.lineTo(-30*constriction, -125);
        ctx.closePath();

        //ctx.closePath();
        ctx.fill();
      }


      //1~12円作成
      ctx.font = "bold 20pt sans-serif";
      ctx.textAlign = "center";
      ctx.translate(400, 400);
      for (var i = 1; i <= 12; i++) {
         var text = i;
         ctx.rotate(Math.PI / 6);
         ctx.save();
         ctx.translate(0, -220);
         ctx.fillText(text, 0, 0);
         ctx.font = "bold 10pt sans-serif";
         ctx.fillText("月", 30, 0);

         inForeigner(i);
         outJapanese(i);
         ctx.restore();
      }

      </script>
</body>
</html>
